{% extends "base.html.twig" %}
{% block body %}
<div ng-app="leges" eui-index="'legi'" ng-cloack><!-- ACTION: change to index name -->

    <div class="container-fluid">

        <div class="row">
            <div class="col-xs-3 sidebar">
                <h3>Rechercher dans le nom du code"{{ app.request.locale }}"</h3>
                <eui-searchbox field="'ARTICLE.CONTEXTE.TEXTE.TITRE_TXT.$t'"></eui-searchbox> <!-- ACTION: change to field to search on -->
                <h3>Rechercher dans l'article</h3>
                <h6>ARTICLE.BLOC_TEXTUEL.CONTENU.$t</h6>
                <eui-searchbox field="'ARTICLE.BLOC_TEXTUEL.CONTENU.$t'"></eui-searchbox> <!-- ACTION: change to field to search on -->
                <h6>ARTICLE.BLOC_TEXTUEL.CONTENU.p.$t</h6>
                <eui-searchbox field="'ARTICLE.BLOC_TEXTUEL.CONTENU.p.$t'"></eui-searchbox> <!-- ACTION: change to field to search on -->
                <h3>CODEX</h3>
                <eui-singleselect field="'ARTICLE.CONTEXTE.TEXTE.@cid'" size="5"></eui-singleselect> <!-- ACTION: change to field to use as facet -->
                <h3>DICTUM</h3>
                <eui-singleselect field="'ARTICLE.META.META_COMMUN.ID.$t'" size="5"></eui-singleselect> <!-- ACTION: change to field to use as facet -->
                <h3>Multi select facet</h3>
                <eui-checklist field="'ARTICLE.BLOC_TEXTUEL.CONTENU.$t'" size="10"></eui-checklist> <!-- ACTION: change to field to use as facet -->
                <h3>Results Per Page</h3>
                <select ng-model="indexVM.pageSize">
                    <option ng-repeat="item in [10, 20, 50, 100]">{[{item}]}</option>
                </select>
            </div>
            <div class="col-xs-9 col-xs-offset-3 main">
<!--                 <div class="instructions panel panel-primary">
                    <!- - README - ->
                    <div class="panel-heading">Getting started with the Demo</div>
                    <div class="panel-body">
                        Instructions, modify this file according to the following:
                        <ol>
                            <li>Set the constant euiHost in &lt;head&gt; to point to your cluster</li>
                            <li>Change eui-index on &lt;body&gt; tag to the name of your index</li>
                            <li>Set the field attributes on the facets in the sidebar to meaningful fields of your data</li>
                        </ol>
                    </div>
                </div>
 -->
                <h1>Resultats</h1>
                <div ng-repeat="doc in indexVM.results.hits.hits" style="margin-bottom:40px;">
                    <div style="padding:10px; border:1px solid #333333; margin-bottom:20px;">
                        <div style="margin-bottom:20px;">
                        {[{ doc._source.ARTICLE.CONTEXTE.TEXTE.TITRE_TXT.$t }]} - {[{ doc._source.ARTICLE.META.META_COMMUN.NATURE.$t }]}&nbsp;{[{ doc._source.ARTICLE.META.META_SPEC.META_ARTICLE.NUM.$t }]}<br/>
                        CODEX : {[{ doc._source.ARTICLE.CONTEXTE.TEXTE['@cid'] }]}<br/>
                        DICTUM : {[{ doc._source.ARTICLE.META.META_COMMUN.ID.$t }]}
                        </div>
                        <div style="margin-bottom:20px;font-weight:bold;">
                            <p>{[{doc._source.ARTICLE.BLOC_TEXTUEL.CONTENU.$t | nquote}]}</p>
                            <p>{[{ doc._source.ARTICLE.BLOC_TEXTUEL.CONTENU.p.$t | nquote }]}</p>
                            <p ng-repeat="p in doc._source.ARTICLE.BLOC_TEXTUEL.CONTENU.p">
                                <span>{[{p.$t | nquote}]}</span>
                            </p>
                            <p>{[{doc._source.ARTICLE.BLOC_TEXTUEL.CONTENU.div.$t | nquote}]}</p>
                            <p ng-repeat="p in doc._source.ARTICLE.BLOC_TEXTUEL.CONTENU.div.p">
                                <span>{[{p.$t | nquote}]}</span>
                            </p>
                            <table>
                                <tbody ng-repeat="tr in doc._source.ARTICLE.BLOC_TEXTUEL.CONTENU.table.tbody.tr">
                                    <tr>{[{tr.$t | nquote}]}</tr>
                                </tbody>
                            </table>
                            <hr/>
                        </div>
                        <div style="margin-bottom:20px;">
                        <a target="_blank" href="//www.legifrance.gouv.fr/affichCodeArticle.do?cidTexte={[{ doc._source.ARTICLE.CONTEXTE.TEXTE['@cid'] }]}&idArticle={[{ doc._source.ARTICLE.META.META_COMMUN.ID.$t }]}"/>
                            Legifrance : {[{ doc._source.ARTICLE.CONTEXTE.TEXTE.TITRE_TXT.$t }]} - {[{ doc._source.ARTICLE.META.META_COMMUN.NATURE.$t }]}&nbsp;{[{ doc._source.ARTICLE.META.META_SPEC.META_ARTICLE.NUM.$t }]}
                        </a>
                        <br/>
                        <a target="_blank" href="http://163.172.35.42:5601/app/kibana?#/discover/All-leges?_g=(refreshInterval:(display:Off,pause:!f,value:0),time:(from:now-15m,mode:quick,to:now))&_a=(columns:!(_index,'ARTICLE.CONTEXTE.TEXTE.@cid','ARTICLE.META.META_COMMUN.ID.$t',_score,'ARTICLE.CONTEXTE.TEXTE.TITRE_TXT.$t','ARTICLE.CONTEXTE.TEXTE.TM.TITRE_TM.$t','ARTICLE.CONTEXTE.TEXTE.TM.TM.TITRE_TM.$t','ARTICLE.CONTEXTE.TEXTE.TM.TM.TM.TITRE_TM.$t','ARTICLE.CONTEXTE.TEXTE.TM.TM.TM.TM.TITRE_TM.$t','ARTICLE.CONTEXTE.TEXTE.TM.TM.TM.TM.TM.TITRE_TM.$t','ARTICLE.CONTEXTE.TEXTE.TM.TM.TM.TM.TM.TM.TITRE_TM.$t','ARTICLE.CONTEXTE.TEXTE.TM.TM.TM.TM.TM.TM.TM.TITRE_TM.$t','ARTICLE.CONTEXTE.TEXTE.TM.TM.TM.TM.TM.TM.TM.TM.TITRE_TM.$t','ARTICLE.CONTEXTE.TEXTE.TM.TM.TM.TM.TM.TM.TM.TM.TM.TITRE_TM.$t','ARTICLE.CONTEXTE.TEXTE.@nature','ARTICLE.META.META_COMMUN.NATURE.$t','ARTICLE.META.META_SPEC.META_ARTICLE.NUM.$t','ARTICLE.META.META_SPEC.META_ARTICLE.DATE_DEBUT.$t','ARTICLE.META.META_SPEC.META_ARTICLE.DATE_FIN.$t','ARTICLE.BLOC_TEXTUEL.CONTENU.$t',ARTICLE.BLOC_TEXTUEL.CONTENU.p,'ARTICLE.BLOC_TEXTUEL.CONTENU.p.$t','ARTICLE.BLOC_TEXTUEL.CONTENU.div.$t',ARTICLE.BLOC_TEXTUEL.CONTENU.div.p,ARTICLE.BLOC_TEXTUEL.CONTENU.table.tbody.tr,ARTICLE.BLOC_TEXTUEL.CONTENU.br,'ARTICLE.NOTA.CONTENU.$t','ARTICLE.NOTA.CONTENU.p.$t','ARTICLE.META.META_SPEC.META_ARTICLE.ETAT.$t','ARTICLE.CONTEXTE.TEXTE.TM.TITRE_TM.@id','ARTICLE.CONTEXTE.TEXTE.TM.TM.TITRE_TM.@id','ARTICLE.CONTEXTE.TEXTE.TM.TM.TM.TITRE_TM.@id','ARTICLE.CONTEXTE.TEXTE.TM.TM.TM.TM.TITRE_TM.@id','ARTICLE.CONTEXTE.TEXTE.TM.TM.TM.TM.TM.TITRE_TM.@id','ARTICLE.CONTEXTE.TEXTE.TM.TM.TM.TM.TM.TM.TITRE_TM.@id','ARTICLE.CONTEXTE.TEXTE.TM.TM.TM.TM.TM.TM.TM.TITRE_TM.@id','ARTICLE.CONTEXTE.TEXTE.TM.TM.TM.TM.TM.TM.TM.TM.TITRE_TM.@id','ARTICLE.CONTEXTE.TEXTE.TM.TM.TM.TM.TM.TM.TM.TM.TM.TITRE_TM.@id'),filters:!(),index:legi,interval:auto,query:(query_string:(analyze_wildcard:!t,query:{[{ doc._source.ARTICLE.META.META_COMMUN.ID.$t }]})),sort:!('{[{ doc._source.ARTICLE.META.META_COMMUN.ID.$t }]}',asc))"/>
                            Elasticsearch : {[{ doc._source.ARTICLE.CONTEXTE.TEXTE.TITRE_TXT.$t }]} - {[{ doc._source.ARTICLE.META.META_COMMUN.NATURE.$t }]}&nbsp;{[{ doc._source.ARTICLE.META.META_SPEC.META_ARTICLE.NUM.$t }]}
                        </a>
                        </div>
                    </div>
                    <!--div style="color:#aaaaaa; margin-bottom:20px;">
                        { [ { doc._source | json } ] }<br/>
                    </div-->
                    <hr/>
                </div>
                <eui-simple-paging></eui-simple-paging>
            </div>
        </div>
    </div>
</div>
{% endblock %}
{% block stylesheets %}
<link rel="stylesheet" href="//netdna.bootstrapcdn.com/bootstrap/3.1.1/css/bootstrap.min.css" />
{% endblock %}
{% block css %}
<style>
    .sidebar {
        position: fixed;
        top: 0;
        bottom: 0;
        z-index: 1000;
        display: block;
        padding: 20px;
        overflow-x: hidden;
        overflow-y: auto;
        background-color: #f5f5f5;
        border-right: 1px solid #eee;
    }

    .instructions {
        display: block;
        margin: 0 auto;
        width: 450px;
    }
</style>
{% endblock %}
{% block javascripts %}
<script src="//code.angularjs.org/1.2.16/angular.js"></script>
<script src="//code.angularjs.org/1.2.25/angular-sanitize.js"></script>
<script src="{{ asset('js/elastic.js') }}"></script>
<script src="{{ asset('js/elasticsearch.angular.js') }}"></script>
<script src="{{ asset('js/elasticui.js') }}"></script>
{% endblock %}
{% block js %}
<script>
    angular
        .module('leges', ['elasticui', 'ngSanitize'])
        .filter('nquote',function() {
            return function(input) {
                if (input) {
                    return input.replace(/&#39;|U\+0027/g, '\'');
                }
            }
        })
        .config(function($interpolateProvider){
            $interpolateProvider
                .startSymbol('{[{')
                .endSymbol('}]}');
        })
        .constant('euiHost', 'http://163.172.35.42:9200'); // ACTION: change to cluster address
</script>
{% endblock %}
